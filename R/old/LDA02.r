## LDA analysis
library(MASS)
library(ggplot2)
require(gridExtra)
setwd("/home/homero/KDB/Projectes/dakd-project/R")

model.evaluation <- function(dataset){
  accurate <- dataset[ which(dataset$reallabel == dataset$label), ]
  nrow(accurate)
  errors <- dataset[ which(dataset$reallabel != dataset$label),]
  error.rate <- round(nrow(errors)/nrow(dataset) * 100,2)
  return(error.rate)
}


dataset.Stats <- function(x) {
  result <- table(x[,3])
  l <- nrow(x)
  result <- round(result *100/l,0)
  print(result)
  #return(result)
}


csvData <- read.csv(file="data_20171220.csv", header=TRUE, sep=",")

  
trainData2 <- csvData[c(1:99,200:600,1100:1326),]
testData2 <- csvData[c(100:200,600:1100,1327:1426),]

dataset.Stats(csvData)
dataset.Stats(trainData2)
dataset.Stats(testData2)


#nrow(trainData)
#ncol(trainData)
#names(trainData)

#nrow(trainData2)
#ncol(trainData2)
#names(trainData2)

lda.model2 <- lda(csvData[,3] ~ ., data=csvData[c(8:251)])

table(csvData[,3] )
# labels amb pocs 1, -> eliminar
# >14 ok

lda.prediction <- predict(object = lda.model2, newdata = testData2)
dataset <- data.frame(label=lda.prediction$class, lda=lda.prediction$x, hash=testData2[,4] ,reallabel=testData2[,3])

nrow(dataset)
head(dataset$label)
head(dataset$reallabel)




p1 <- ggplot(dataset, aes(x=lda.LD1, y=lda.LD2, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-50,50))

p2 <- ggplot(dataset, aes(x=lda.LD1, y=lda.LD3, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-50,50))

p3 <- ggplot(dataset, aes(x=lda.LD1, y=lda.LD4, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-50,50))

p4 <- ggplot(dataset, aes(x=lda.LD2, y=lda.LD3, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-50,50))

p5 <- ggplot(dataset, aes(x=lda.LD2, y=lda.LD4, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-50,50))

p6 <- ggplot(dataset, aes(x=lda.LD3, y=lda.LD4, colour=label, shape=reallabel)) +
  geom_point() +
  coord_cartesian(ylim=c(-20,20),xlim=c(-25,25))

grid.arrange(p1,p2,p3,p4,p5,p6)
grid.arrange(p4,p6)
p6

table(dataset[,2])

# data cleaning 
#  empty groups -> filter out
#  test with 2, 3 main classes

# data mining alg:
# FDA is not suitable for sparse interger matrix
# 0) percentages? -> real number + somehow reduce sparsity
# 1) iterar els pca's creant clasif fins que rendiment baixi ( # 30ena  i reals)
# 2) embedding (software: gensim embedding)
# 3) svm
# 4) psa
