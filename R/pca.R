setwd("/home/pau/Projectes/dakd-project/R")



csvData2 <- read.csv(file="data_20171231.csv", header=TRUE, sep=",")
csvData2.named <- csvData2

# change column names (API call name) to numbers
colnames(csvData2) <- c(1:ncol(csvData2))

# pca computation
pca.data <- prcomp(csvData2[,c(9:length(csvData2))])

# pca summary
summary(pca.data)

# plot of the variance explained by each pc (first 10 pc)
plot(pca.data)

# first 3 factor variables factor map 
api.names <- colnames(csvData2.named)[c(9:ncol(csvData2.named))]
final.pca.data <- pca.data.named$x[c(1:3),]
final.names <- api.names[c(1:3)]
biplot(x=final.pca.data,
       y=final.pca.data,
       xlabs=final.names,
       ylabs=final.names,
       arrow.len = 0.1,
       xlim=c(-1500,200),
       ylim=c(-1500,200),
       cex=1
       )

# rotation
pca.data$rotation




# biplot of samples in 2-dim space of 2 first principal components
library(ggbiplot)
g <- ggbiplot(pca.data,scale = 0, var.scale = 10, labels=csvData2[,4], groups=csvData2[,4],
              ellipse = FALSE, 
              circle = FALSE,
              varname.size = 1,
              varname.abbrev = TRUE,
              var.axes = FALSE)
g <- g + scale_color_discrete(name = '')
g <- g + theme(legend.direction = 'horizontal', 
               legend.position = 'top')
print(g)


# excluding one outlier in the PC2 -> max PC2, to see with more detail the samples distribution
outlier <- match(min(pca.data$x[,2]), pca.data$x[,2]) # 4062
pca.data2$x <- pca.data$x[(pca.data$x[,2] != min(pca.data$x[,2])),]
csvData3 <- csvData2[c(1:(outlier - 1),(outlier + 1):nrow(csvData2)),]
g <- ggbiplot(pca.data2,scale = 6, var.scale = 0, labels=csvData3[,4], groups=csvData3[,4],
              ellipse = TRUE, 
              circle = TRUE,
              varname.size = 1,
              varname.abbrev = TRUE,
              var.axes = FALSE)
g <- g + scale_color_discrete(name = '')
g <- g + theme(legend.direction = 'horizontal', 
               legend.position = 'top')
print(g)



