#SVM
setwd("/home/pau/Projectes/dakd-project/R")
source('exploration_functions.R')
source('pca_functions.R')
source('fda_functions.R')
source('validation_functions.R')

# load the dataset
csvData2 <- read.csv(file="data_20171231.csv", header=TRUE, sep=",")
csvData2 <- filter.minor.classes(csvData2)

library(e1071)


svm.model.training <- function(x){
  data <- x[,c(9:length(x))]
  svm_model <- svm(x$label ~ . , data=data, method="C-classification", kernel="linear")
  return(svm.model) 
}



svm.model.predictor <- function(model, testData2){
  model.prediction <- predict(object = model, newdata = testData2)
  dataset <- data.frame(label=model.prediction,
                        lda=c(1:length(model.prediction)),
                        #hash=testData2$md5,
                        reallabel=testData2$label)
  
  return(dataset)
}

#Fit a model. The function syntax is very similar to lm function

data <- csvData2[,c(9:length(csvData2))]

#model_svm <- svm(csvData2$label ~ . , data)
svm_model <- svm(csvData2$label ~ . , data=data, method="C-classification", kernel="linear")
svm_model

#Use the predictions on the data

model.prediction <- predict(model_svm, data)
dataset <- data.frame(label=model.prediction,
                      lda=c(1:length(model.prediction)),
                      reallabel=csvData2$label)
errors <- dataset[ which(dataset$reallabel != dataset$label),]
nrow(errors)

df <- data.frame(LDA1=pred, LDA2=lda.values$x[,2], class=lda.values$class, realc=pca.dataset$label )
ggplot(pred, aes(x=LDA1, y=LDA2, color=factor(class))) +
  geom_point(size=1) 

#Plot the predictions and the plot to see our model fit

plot(data[,3],pch=5)
points(data[,1], pred, col = "blue", pch=4)

