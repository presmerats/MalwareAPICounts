library(MASS)
setwd("/home/pau/Projectes/dakd-project/R")
source('exploration_functions.R')
source('pca_functions.R')
source('fda_functions.R')
source('validation_functions.R')
source('benchmark_functions.R')

# load the dataset
csvData2 <- read.csv(file="data_20171231.csv", header=TRUE, sep=",")
csvData2 <- filter.minor.classes(csvData2)

# Hyperparameter selection - first manual iteration
# prepare training and test sets
pca.data <- prcomp(csvData2[,c(9:length(csvData2))])
pca.dataset <- data.frame(pca.data$x[,c(1:5)])
pca.dataset$label <- csvData2$label
trainingset <- pca.dataset[c(1:(nrow(pca.dataset)/2) ),]
testset <- pca.dataset[c( (nrow(pca.dataset)/2):nrow(pca.dataset)),]
# train the model
lda.model <- lda(trainingset$label ~ ., data=trainingset)
# prediction
lda.prediction <- predict(object = lda.model, newdata = testset)
prediction.results <- data.frame(label=lda.prediction$class,
                      lda=lda.prediction$x,
                      reallabel=testset$label)
# accuracy computation
errors <- prediction.results[ which(prediction.results$reallabel != prediction.results$label),]
accuracy <- round(1 - nrow(errors)/nrow(prediction.results),4)
accuracy

# Hyperparameter selection - final automated computation
accuracies <- num.princomp.validation(csvData2)



# Performance of the model
pca.dataset <- pca.computation(csvData2,52)
accuracy <- kfold.stratified.validation(pca.dataset) 
accuracy



