library(MASS)
library(ggplot2)
require(gridExtra)
library(corrplot)

setwd("/home/pau/Projectes/dakd-project/R")
source('exploration_functions.R')


# loading dataset
csvData2 <- read.csv(file="data_20171231.csv", header=TRUE, sep=",")

# filtering out minor classes
dataset.Stats(csvData2)
levels(csvData2$label)
csvData2 <- filter.minor.classes(csvData2)
dataset.Stats(csvData2)
levels(csvData2$label)


#column means

# column means for each class
trojan.class <- plot.class.mean(csvData2,"trojan")
adware.class <- plot.class.mean(csvData2,"adware")
ransomware.class <- plot.class.mean(csvData2,"ransomware")
downloader.class <- plot.class.mean(csvData2,"downloader")
malicious.class <- plot.class.mean(csvData2,"malicious")
unknown.class <- plot.class.mean(csvData2,"unknown")

# zooming in the column means of trojan class
plot(c(1:30),colMeans(trojan.class[,c(1:30)]))



# pca transformation
PCA1 <- prcomp(csvData2[,c(9:ncol(csvData2))])
pca.dataset <- data.frame(PCA1$x)
pca.dataset$name <- csvData2$name
pca.dataset$label <- csvData2$label
pca.dataset$md5 <- csvData2$md5
pca.dataset$sha1 <- csvData2$sha1
pca.dataset$sha256 <- csvData2$sha256
pca.dataset$sha512 <- csvData2$sha512

# column means for each class after PCA transformation
trojan.class <- plot.class.mean(pca.dataset,"trojan")
adware.class <- plot.class.mean(pca.dataset,"adware")
ransomware.class <- plot.class.mean(pca.dataset,"ransomware")
downloader.class <- plot.class.mean(pca.dataset,"downloader")
malicious.class <- plot.class.mean(pca.dataset,"malicious")
unknown.class <- plot.class.mean(pca.dataset,"unknown")

# zooming in the column means of trojan class
plot(c(1:30),colMeans(trojan.class[,c(1:30)]))




#correlation matrix

#removing X.1,X,label and hashes columns! only the name 
drops <- c("X.1","X","name", "label", "sha256","sha512", "sha1", "md5")
csvData3 <- csvData2[, !(names(csvData2) %in% drops)]
colnames(csvData3) <- c(1:ncol(csvData3))

M<-cor(csvData3)
head(round(M,2))
corrplot(M[c(1:100), c(1:100)], method="circle")
corrplot(M[c(1:15), c(1:15)], method="number")
corrplot(M[c(250:265), c(250:265)], method="number")

# pca transformation
# pca transformation
PCA1 <- prcomp(csvData2[,c(9:ncol(csvData2))])
pca.dataset <- data.frame(PCA1$x)
pca.dataset$name <- csvData2$name
pca.dataset$label <- csvData2$label
pca.dataset$md5 <- csvData2$md5
pca.dataset$sha1 <- csvData2$sha1
pca.dataset$sha256 <- csvData2$sha256
pca.dataset$sha512 <- csvData2$sha512

# reeval correlation
pcaData3 <- pca.dataset[, !(names(pca.dataset) %in% drops)]
colnames(pcaData3) <- c(1:ncol(pcaData3))
M<-cor(pcaData3)
ncol(pcaData3)
corrplot(M, method="circle")
#corrplot(M[c(1:10), c(1:10)], type="upper", order="hclust", col=c("black", "white"),
#         bg="lightblue")
corrplot(M[c(1:15), c(1:15)], method="number")







